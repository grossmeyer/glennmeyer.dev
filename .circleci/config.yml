---
version: 2.1
jobs:
  build:
    docker:
      - image: circleci/hugo:latest
    working_directory: ~/glennmeyer.dev
    steps:
      - add_ssh_keys:
          fingerprints:
            - "07:46:12:6e:fe:2c:ce:41:2e:8a:05:84:cf:d2:05:61"
      - checkout
      - run:
          name: Clone repo
          working_directory: ~/
          command: git clone -b master git@github.com:grossmeyer/glennmeyer.dev public
      - run:
          name: Build site
          working_directory: ~/glennmeyer.dev
          command: HUGO_ENV=production hugo -d ~/public
      - deploy:
          name: Deploy to netlify
          working_directory: ~/public
          command: /
            git config credential.helper 'cache --timeout=120'
            git config user.email "grossmeyer@gmail.com"
            git config user.name "CircleCI"
            git add .
            git commit --allow-empty -m "Trigger deployment"
            git push -q git@github.com:<USERNAME/ORGANIZATION>/<SITE_NAME>.github.io.git master

workflows:
  main:
    jobs:
    - hugo/build:
        html-proofer: true
        source: src/
        version: '0.55'
    - build:
        filters:
          branches:
            only: master
...