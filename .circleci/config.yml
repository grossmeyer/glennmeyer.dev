---
version: 2.1
jobs:
  build:
    docker:
      - image: cibuilds/hugo:latest
    working_directory: ~/glennmeyer.dev
    steps:
      - add_ssh_keys:
          fingerprints:
            - "07:46:12:6e:fe:2c:ce:41:2e:8a:05:84:cf:d2:05:61"
      - checkout
      - run:
          name: Clone repo
          working_directory: ~/
          command: git clone -b master git@github.com:grossmeyer/glennmeyer.dev public
      - run:
          name: Build site
          working_directory: ~/glennmeyer.dev
          command: HUGO_ENV=production hugo -d ~/public
      - deploy:
          name: Deploy to netlify
          working_directory: ~/public
          command: |
            echo Start;
            git config credential.helper 'cache --timeout=120';
            git config user.email "grossmeyer@gmail.com";
            git config user.name "CircleCI";
            git add .;
            git commit --allow-empty -m "Trigger deployment";
            git push -q git@github.com:grossmeyer/glennmeyer.dev master;
            echo Done;

workflows:
  main:
    jobs:
    - build:
        filters:
          branches:
            only: master
...